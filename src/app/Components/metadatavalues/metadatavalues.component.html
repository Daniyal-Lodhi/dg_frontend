<div class="flex sm:pr-2" *ngIf="Data; else loading">
    <!-- Trigger display id is to get the id number of the meta data value that has to be displayed -->
    <!-- <app-side-nav *ngIf="ColumnsData" (triggerDisplayId)="displayData($event)" [treeData]="ColumnsData"
        [forComponent]="'metaDataValues'"></app-side-nav> -->
    <!-- tree structure -->
    <div>
        <div class="flex h-screen sm:mt-1  overflow-hidden z-10 fixed top-0 sm:relative">
            <mat-drawer-container class="example-container w-auto h-auto " [hasBackdrop]="false">
                <mat-drawer #drawer [mode]="'side'" class="w-64 h-full pt-10 sm:pt-0" opened="true">

                    <div>
                        <!-- div for button -->

                        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl" class="ml-2">
                            <!-- This is the tree node template for leaf nodes -->
                            <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
                                <!-- use a disabled button to provide padding for tree leaf -->
                                <!-- <button mat-icon-button disabled></button> -->

                                <!-- InvokedTriggerID to send the id of display node and its parent node to the parent component -->
                                <button 
                                    (click)="displayTreeData({displayId:node.displayId,parentId:node.parentId})" (click)="getAliases(Data.id)">{{node.name}}
                                
                                </button>
                                    
                                <!-- <button routerLink="/orders" >{{node.name}}</button> -->

                            </mat-tree-node>
                            <!-- This is the tree node template for expandable nodes -->
                            <mat-tree-node *matTreeNodeDef="let node;when: hasChild" class="font-bold">

                                <!-- InvokedTriggerID to send the id of displaynode to the parent component -->
                                <button (click)="displayTreeData({displayId:node.displayId, parentId:undefined})"
                                    id="nodeLink" matTreeNodeToggle [attr.aria-label]="'Toggle' + node.name">
                                    <mat-icon class="mat-icon-rtl-mirror">
                                        {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                                    </mat-icon>

                                    {{node.name }}
                                </button>
                            </mat-tree-node>
                        </mat-tree>
                    </div>
                </mat-drawer>
                <!-- <mat-drawer-content class="w-auto">
                  </mat-drawer-content> -->
            </mat-drawer-container>
            <button (click)="drawer.toggle()"
                class="bg-black rounded-full h-max mt-20 sm:mt-1 py-1 px-3 text-white">></button>
        </div>
    </div>
    <div class="sm:w-[95%] sm:ml-2 mt-8 sm:mt-0 w-full flex-col " *ngIf="Data">
        <div class="flex-col mt-5 ">
            <div class="flex justify-between mx-2 sm:mx-0 mb-3">
                <div class="text-2xl text-gray-700 font-bold " *ngIf="Data.tableName">Table: {{Data.tableName}}</div>
                <div class="text-2xl text-gray-700 font-bold " *ngIf="Data.columnName">Column: {{Data.columnName}}</div>

                <button (click)="toggleshowAddEntity()"
                    class="bg-black text-white px-2 py-1 rounded-md">{{!showAddEntity?"Map business entities":"Close mapping"}}</button>
            </div>

            <div *ngIf="showAddEntity" class="mt-6 mb-3  mx-2 sm:mx-0">
                <form>
                    <mat-form-field class="example-chip-list ">
                        <mat-label>Business domains entities linking</mat-label>
                        <mat-chip-grid #chipGrid aria-label="Entity selection">
                            <ng-container *ngFor="let Entity of businesdomainEntities; let i = index">
                                <mat-chip #chipGrid aria-label="Entity selection">
                                    <mat-chip-row (removed)="remove(Entity)">
                                        {{ Entity.name }}
                                        <button matChipRemove [attr.aria-label]="'remove ' + Entity">
                                            <mat-icon>cancel</mat-icon>
                                        </button>
                                    </mat-chip-row>
                                </mat-chip>
                            </ng-container>
                        </mat-chip-grid>
                        <input placeholder="Add entity" class="rounded-lg" #EntityInput id="entinput" 
                            [formControl]="domainCtrl" [matChipInputFor]="chipGrid" [matAutocomplete]="auto"
                            [matChipInputSeparatorKeyCodes]="separatorKeysCodes" (matChipInputTokenEnd)="add($event)" />

                        <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                            <ng-container *ngFor="let entity of filtered_businesdomainEntities | async">
                                <mat-option *ngIf="!businesdomainEntities.includes(entity.name)" [value]="entity.name">
                                    {{entity.name}}
                                </mat-option>
                                <!-- {{ entity.name }} -->
                            </ng-container>
                        </mat-autocomplete>



                    </mat-form-field>
                </form>
                <div *ngIf="Data.tableName" class="flex-col items-end space-y-2 ">
                    <button (click)="mapTableAndEntities(Data.id)"
                        class="bg-green-500 text-white px-2 py-1 rounded-md">{{businesdomainEntities.length<=1?'Map entity':'Map Entities'}}</button>
                            <p class="text-slate-700 text-xs">(The slected business domain entities will be mapped to
                                current {{Data.tableName?'table':'column'}})</p>

                </div> 
                <div *ngIf="Data.columnName" class="flex-col items-end space-y-2">
                    <button (click)="mapColumnAndEntities(Data.id)"
                        class="bg-green-500 text-white px-2 py-1 rounded-md">{{businesdomainEntities.length<=1?'Map entity':'Map Entities'}}</button>
                            <p class="text-slate-700 text-xs">(The slected business domain entities will be mapped to
                                current {{Data.tableName?'table':'column'}})</p>

                </div>

            </div>
            <div class="mt-2 w-auto sm:mt-5 mx-2 bg-gray-white text-base border-slate-300 border mb-4  rounded-lg p-2 sm:mx-0 text-gray-700"
                *ngIf="Data.schemaName">
                <table class="w-[50%] border-separate  border-spacing-y-1 text-base">
                    <!-- <tr *ngIf="Data.tableName">
                        <td class="label">Table name:</td>
                        <td>{{ Data.tableName }}</td>
                    </tr>
                    <tr *ngIf="Data.columnName">
                        <td class="label">Column name:</td>
                        <td>{{ Data.columnName }}</td> 
                    </tr> -->
                    <tr *ngIf="Data.schemaName">
                        <td class="label">Schema:</td>
                        <td>{{ Data.schemaName }}</td>
                    </tr>
                </table>
            </div>
            <div *ngIf="aliases">
                <div class="px-2 py-1 border rounded-lg my-2">
                    <div class="text-base font-bold">Aliases:</div>
                    <div class="flex flex-wrap mt-2">
                        <div *ngFor="let alias of aliases" class="flex  mr-2 mb-2">
                            <div class="mr-2 mb-2 relative bg-slate-500 text-white px-3 py-1 rounded-full text-sm">
                                <p>{{alias.aliasName}}</p>
                                <button (click)="deleteModal=true" class="absolute -top-1 -right-1 bg-red-600 rounded-full text-white px-1 text-xs ">x</button>
                            </div>  
                            <!-- del -->
                            <div *ngIf="deleteModal" >
                                <div class="relative z-10" aria-labelledby="modal-title" role="dialog"
                                aria-modal="true">
                                <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>
                                <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
                                    <div
                                        class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
                                        <div
                                            class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">
                                            <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                                                <div class="sm:flex sm:items-start">
                                                    <div
                                                        class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                                                        <svg class="h-6 w-6 text-red-600" fill="none"
                                                            viewBox="0 0 24 24" stroke-width="1.5"
                                                            stroke="currentColor" aria-hidden="false">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                                        </svg>
                                                    </div>
                                                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                                                        <h3 class="text-base font-semibold leading-6 text-gray-900"
                                                            id="modal-title">Delete Entity</h3>
                                                        <div class="mt-2">
                                                            <p class="text-sm text-gray-500">Are you sure you
                                                                want to delete this business domain entity?</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div
                                                class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                                                <button  (click)="deleteAlias(alias.id,alias.aliasName)"
                                                    class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Delete</button>
                                                <button  (click)="deleteModal=false"
                                                    class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            </div>  
                            
                           
                        </div> 
                        <!-- <div class="">
                            <input [(ngModel)]="aliasName" name="alias" type="text" placeholder="Enter alias name" class="mb-2 text-sm border-b outline-none mr-3">   
                            <button (click)="postAlias()" #aliasbtn class="px-3 py-1 bg-slate-800 hover:bg-black rounded-md text-white ">+</button>

                            </div> -->
                    </div>
                       <div class="ml-2">
                            <input [(ngModel)]="aliasName" name="alias" type="text" placeholder="Enter alias name" class="mb-2 text-sm border-b outline-none mr-3">   
                            <button (click)="postAlias()" #aliasbtn id="aliasbtn" class="px-3 py-1 bg-slate-800 hover:bg-black rounded-md text-white ">+</button>
                            </div>
                            
                </div>

                
            </div>
            <div class="border border-slate-300 rounded-lg px-2 my-3">

                <div class="ml-5"
                    *ngIf=" (Data.columnEntityMapDto && LengthOf(Data.columnEntityMapDto) > 0) || (Data.mappedBusinessDomainEntitiesDto && LengthOf(Data.mappedBusinessDomainEntitiesDto) != 0) "
                    class="mb-2 mt-1">
                    <div class=" text-base mt-0 mb-3 font-bold  text-slate-700  sm:ml-0"> Mapped buisness domain
                        Entites:</div>
                    <div class=" flex flex-wrap ">
                        <div class="ml-3 "
                            *ngFor="let mappedEntities of Data.columnEntityMapDto  || Data.mappedBusinessDomainEntitiesDto; index as i ">
                            <div class="bg-slate-500 rounded-full relative text-white text-sm px-3 py-1 mb-2">
                                <button *ngIf="Data.tableName" (click)="deleteTableMapping(mappedEntities.id)" class="absolute bg-black text-white -top-[8px] -right-2 rounded-full text-xs px-2 cursor-pointer">x</button>
                                <button *ngIf="Data.columnName" (click)="deleteColMapping(mappedEntities.id)" class="absolute bg-black text-white -top-[8px] -right-2 rounded-full text-xs px-2 cursor-pointer">x</button>

                                {{
                                mappedEntities.name}}
                                </div>
 
                        </div>
                    </div>
                </div>
            </div>




        </div>
        <div *ngIf="Data.columnName && relatedTerms.data[0]">
            <div class="border p-2 rounded-lg border-slate-300">
                <div class="text-base font-bold mb-2">
                    Related terms:
                </div>
                <div class="flex mt-4 ">
                    <div *ngFor="let related_term of relatedTerms.data"
                        class="bg-slate-500 mr-2 mb-2 rounded-full text-white text-sm px-3 py-1 ">
                        {{related_term}}
                    </div>
                </div>
            </div>
        </div>
        <!-- input values -->
        <div class="my-3 border p-2 rounded-lg border-slate-300" *ngIf="Data.columnName">
            <div class="mb-5 text-xl font-bold">Input Values</div>
            <div>


                <div class="relative overflow-x-auto">
                    <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-400">
                            <tr>
                                <th scope="col" class="px-6 py-3">
                                    Value
                                </th>
                                <th scope="col" class="px-6 py-3">
                                    Description
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700"
                                *ngFor="let value of InputValues">
                                <th scope="row"
                                    class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                    {{value.valueName}}
                                </th>
                                <td class="px-6 py-4">
                                    {{value.description}}
                                </td>
                            </tr>
                            <tr class="bg-white  dark:bg-gray-800 dark:border-gray-700 ">
                                <th scope="row"
                                    class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">
                                    <input [(ngModel)]="valueName" name="name" type="text"
                                        class="inputvalues outline-none" placeholder="Value name here">
                                </th>
                                <td class="px-6 py-4 ">
                                    <input [(ngModel)]="valueDescription" name="desc" type="text"
                                        class="inputvalues outline-none" placeholder="Value description here">
                                </td>
                                <td class="px-6 py-4">
                                    <button (click)="addInputValues()"
                                        class="flex items-center justify-center h-full border my-auto text-center px-3 py-1 bg-slate-900 hover:bg-black rounded-md text-white">+</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                </div>

            </div>

        </div>
    </div>
</div>
<ng-template #loading class=" " >
    <mat-spinner class="mx-auto my-48"  ngClass="align-middle"  id="spinner" diameter="50" ></mat-spinner>

</ng-template>